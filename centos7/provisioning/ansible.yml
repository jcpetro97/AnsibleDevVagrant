---
- hosts:  all
  become: true
  vars:
    AnsibleVersion: "2.9.17"
  tasks:
  - name: yum update
    yum:
      update_cache: yes
  - name: upgrade all packages
    yum:
      name: '*'
      state: latest
    register: patched
    delay: 10
    retries: 12
    become_user: root
    until: patched is successful
  - name: Install python2-pip
    yum:
      name: python2-pip
      state: present    
  - name: Install Ansible
    pip:
      name: ansible
      version: "{{AnsibleVersion}}"
      state: present

  # - name: Add ansible repository.
  #   apt_repository: repo='ppa:ansible/ansible'   
  # - name: Update apt cache.
  #   apt: update_cache=true cache_valid_time=86400    
  # - name: Install Ansible.
  #   apt:
  #     name: ansible
  #     state: present
